"use strict";var map,marker,closestZips=[],allWalmartStores=[],closestStores=[],distances=[];function initMap(){var e=window.matchMedia("(max-width: 768px)");map=e.matches?L.map("mapid").setView([39.8283,-98.5795],2):L.map("mapid").setView([39.8283,-98.5795],3),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(map)}function getURL(){var e=document.getElementById("zipInput").value,t=document.getElementById("selectMiles");return"https://api.zip-codes.com/ZipCodesAPI.svc/1.0/FindZipCodesInRadius?zipcode="+e+"&minimumradius=0&maximumradius="+t.options[t.selectedIndex].value+"&key=S71SJ1GYOPA23ZF25UXL"}function errorHandle(){return document.getElementById("zipInput").style.border="solid 1px #ff0000","Invalid Zip Code"}function clearError(){var e=document.getElementById("zipInput");e.style.borderTop="none",e.style.borderRight="none",e.style.borderLeft="none",e.style.borderBottom="solid 1px #b4b4b4",document.getElementById("error").innerHTML=""}var loading={loadScreen:document.querySelector(".loading"),on:function(){this.loadScreen.style.display="block"},off:function(){this.loadScreen.style.display="none"}},requestError={appear:function(){document.querySelector(".request-error").style.transform="translateY(0px)"},close:function(){document.querySelector(".request-error").style.transform="translateY(-50px)",location.reload()}};function reloadOnce(){window.location.hash||(window.location=window.location+"#loaded",window.location.reload(!0))}function zipRad(){var e=getURL(),o=errorHandle(),t=new XMLHttpRequest,r=document.getElementById("zipInput").value;t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){for(var e=JSON.parse(this.responseText),t=0;t<e.DataList.length;t++)closestZips.push(e.DataList[t]);document.getElementById("zipInput").value="",clearError()}else""!==r&&/(^\d{5}$)|(^\d{5}-\d{4}$)/.test(r)?429==this.status?(loading.off(),requestError.appear()):clearError():(errorHandle(),document.getElementById("error").innerHTML=o)},t.open("GET",e,!0),t.send()}function walmartStores(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==this.readyState&&200==this.status)for(var e=JSON.parse(this.responseText),t=0;t<e.length;t++)allWalmartStores.push(e[t])},e.open("GET","https://gist.githubusercontent.com/anonymous/83803696b0e3430a52f1/raw/29f2b252981659dfa6ad51922c8155e66ac261b2/walmart.json",!0),e.send()}function findClosestStores(){for(var e=0;e<allWalmartStores.length;e++)for(var t=0;t<closestZips.length;t++)allWalmartStores[e].postalCode===closestZips[t].Code&&(closestStores.push(allWalmartStores[e]),distances.push(closestZips[t].Distance));document.querySelector(".pre-text").style.display="none",0===$("#stores li").length||(document.getElementById("stores").innerHTML=""),display(),loading.off()}function display(){for(var e=Math.min.apply(null,distances),t=(distances.indexOf(e),0);t<closestStores.length;t++)for(var o=document.createElement("li"),r=[closestStores[t].city,closestStores[t].name,closestStores[t].address1,closestStores[t].phone_number,distances[t]],n=0;n<r.length;n++){var s=document.createElement("p"),a=document.createTextNode(r[n]);s.appendChild(a),o.appendChild(s),document.getElementById("stores").appendChild(o)}0===closestStores.length&&(loading.off(),document.querySelector(".pre-text").style.display="block",document.querySelector(".pre-text").innerHTML="No stores nearby. Try a different mile radius"),setMap()}function setMap(){var e=Math.min.apply(null,distances),t=distances.indexOf(e);map.setView(new L.LatLng(closestStores[void 0!==t.length?t:0].latitude,closestStores[void 0!==t.length?t:0].longitude),10);for(var o=0;o<closestStores.length;o++)marker=new L.marker([closestStores[o].latitude,closestStores[o].longitude]),markerGroup.addLayer(marker)}function centerOnClick(){var e=$("#stores li").index(this);marker=new L.marker([closestStores[e].latitude,closestStores[e].longitude]).addTo(map).bindPopup(closestStores[e].address1).openPopup(),map.setView(new L.LatLng(closestStores[e].latitude,closestStores[e].longitude),13)}function resetArrays(){closestZips=[],allWalmartStores=[],closestStores=[],distances=[]}function loadDoc(){markerGroup.clearLayers(),loading.on(),zipRad(),walmartStores(),setTimeout(findClosestStores,2e3),resetArrays()}function createEventListeners(){var e=document.getElementById("btn"),t=document.getElementById("close");e.addEventListener?e.addEventListener("click",loadDoc,!1):e.attachEvent&&e.attachEvent("onclick",loadDoc),$(document).keypress(function(e){"13"==(e.keyCode?e.keyCode:e.which)&&(e.preventDefault(),loadDoc())}),window.addEventListener?window.addEventListener("load",reloadOnce,!1):window.attachEvent&&window.attachEvent("onload",reloadOnce),$("body").on("click","#stores li",centerOnClick),t.addEventListener?t.addEventListener("click",requestError.close,!1):t.attachEvent&&t.attachEvent("click",requestError.close)}initMap();var markerGroup=L.layerGroup().addTo(map);createEventListeners();